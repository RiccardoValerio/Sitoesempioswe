{%- comment -%}
Render di una sezione da dati YAML.
Parametri: section (oggetto con id, title, groups[*])
Ogni group pu√≤ avere:
  - subsections: array di { title, dir, exts }
  - oppure: { title, dir, exts } semplice (diventa "Extra")
{%- endcomment -%}

{%- assign s = include.section -%}
<section id="{{ s.id }}" class="section">
  <h2>{{ s.title }}</h2>

  {%- for g in s.groups -%}
    {%- assign has_any = false -%}

    {%- if g.subsections and g.subsections.size > 0 -%}
      {%- comment -%} Gruppo con sottosezioni {%- endcomment -%}
      {%- capture rendered_subs -%}
        {%- for sub in g.subsections -%}
          {%- capture block -%}{% include list-files.html dir=sub.dir exts=sub.exts %}{%- endcapture -%}
          {%- assign block = block | strip -%}
          {%- if block != "" -%}
            {%- assign has_any = true -%}
            <details class="accordion nested"{% if forloop.first %} open{% endif %}>
              <summary><span class="acc-title">{{ sub.title }}</span></summary>
              {{ block }}
            </details>
          {%- endif -%}
        {%- endfor -%}
      {%- endcapture -%}
      {%- if has_any -%}
        <details class="accordion" open>
          <summary><span class="acc-title">{{ g.title }}</span></summary>
          {{ rendered_subs }}
        </details>
      {%- endif -%}

    {%- else -%}
      {%- comment -%} Gruppo semplice (es. Extra) {%- endcomment -%}
      {%- capture simple_block -%}{% include list-files.html dir=g.dir exts=g.exts %}{%- endcapture -%}
      {%- assign simple_block = simple_block | strip -%}
      {%- if simple_block != "" -%}
        <div class="uncat">
          <h3 class="uncat-title">{{ g.title }}</h3>
          {{ simple_block }}
        </div>
      {%- endif -%}
    {%- endif -%}

  {%- endfor -%}
</section>
